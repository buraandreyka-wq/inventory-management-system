<!doctype html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('Корректировка остатков')}"></head>
<body>
<div th:replace="~{fragments/layout :: navbar}"></div>
<div th:replace="~{fragments/layout :: alerts}"></div>

<main class="container py-4" style="max-width: 920px">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h4 mb-0">Корректировка остатков</h1>
        <a class="btn btn-outline-secondary" th:href="@{/stock(warehouseId=${warehouseId})}">К остаткам</a>
    </div>

    <div class="card">
        <div class="card-body">
            <form th:action="@{/stock/adjust}" method="post" class="row g-3" id="adjustForm">

                <div class="col-md-6">
                    <label class="form-label">Склад</label>
                    <select class="form-select" name="warehouseId" required>
                        <option value="" th:selected="${warehouseId == null}">Выберите склад…</option>
                        <option th:each="w : ${warehouses}"
                                th:value="${w.id}"
                                th:text="${w.name}"
                                th:selected="${warehouseId != null and w.id == warehouseId}">
                            Warehouse
                        </option>
                    </select>
                </div>

                <div class="col-md-6">
                    <label class="form-label">Товар</label>
                    <select class="form-select" name="productId" required>
                        <option value="">Выберите товар…</option>
                        <option th:each="p : ${products}"
                                th:value="${p.id}"
                                th:text="${p.sku + ' — ' + p.name}">
                            Product
                        </option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label class="form-label">Операция</label>
                    <select class="form-select" name="type" required>
                        <option value="IN">Поступление (+)</option>
                        <option value="OUT">Списание (-)</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label class="form-label">Количество</label>
                    <input class="form-control" type="number" name="delta" min="1" step="1" value="1" required/>
                </div>

                <div class="col-md-4 d-flex align-items-end">
                    <button class="btn btn-primary w-100" type="submit">Применить</button>
                </div>

                <div class="col-12">
                    <div class="form-text">
                        Подсказка: выберите склад и товар, затем укажите операцию и количество. После применения вы вернётесь на страницу остатков.
                    </div>
                </div>

            </form>
        </div>
    </div>
</main>

<div th:replace="~{fragments/layout :: scripts}"></div>
<script>
    // небольшая UX-помощь: если склад не выбран, не даём отправить
    document.getElementById('adjustForm')?.addEventListener('submit', function (e) {
        const w = this.querySelector('select[name="warehouseId"]');
        if (!w || !w.value) {
            e.preventDefault();
            alert('Выберите склад');
        }
    });
</script>
</body>
</html>
